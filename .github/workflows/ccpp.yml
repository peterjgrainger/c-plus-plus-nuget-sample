name: C/C++ CI

on: [push]

jobs:
  build:

    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v1
    - uses: olegtarasov/download-nuget@v1
    - name: compile
      run: run.bat
      working-directory: D:\a\c-plus-plus-nuget-sample\c-plus-plus-nuget-sample
      shell: cmd
    - name: pack
      run: nuget pack package
      shell: cmd
    - name: Add private GitHub registry to NuGet
      run: nuget sources add -name "GitHub" -Source https://nuget.pkg.github.com/peterjgrainger/index.json -Username peterjgrainger -Password ${{ secrets.GITHUB_TOKEN }}
    - name: add api key
      run: nuget setapikey ${{ secrets.GITHUB_TOKEN }} -Source "GitHub" 
    - name: Push generated package to GitHub registry
      run: nuget push *.nupkg -Source "GitHub" -SkipDuplicate
